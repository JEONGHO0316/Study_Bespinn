# Shell Script 실무 연습문제 - 네트워크 프로세스 관리

## 사용 가능한 문법 제한사항
- **허용**: `if문`, `변수`, `for문`, `배열`, 기본 shell 명령어
- **금지**: `awk`, `sed`
- **핵심 명령어**: `ss`, `lsof`, `curl`, `telnet`, `kill`, `ps`

---

## 연습문제 1: 포트 사용 여부 확인 스크립트

**문제**  
여러 포트 번호를 인수로 받아서 각 포트가 사용 중인지 확인하는 스크립트를 작성하세요.

**요구사항**
- `ss` 명령어로 포트 상태 확인
- 사용 중인 포트는 `✓`, 사용하지 않는 포트는 `✗` 표시

**스크립트 실행 예제**
```bash
$ ./check_ports.sh 80 443 22 3000 8080
포트 사용 상태 확인 중...
포트 80: ✓ 사용 중
포트 443: ✗ 사용 안함
포트 22: ✓ 사용 중
포트 3000: ✗ 사용 안함
포트 8080: ✓ 사용 중

총 5개 포트 중 3개가 사용 중입니다.
```
# 답 :
```
[jeongho@localhost Downloads]$ source ./check_ports.sh 812 8080 21 22 61
포트 812: ✗ 사용 안함
포트 8080: ✓ 사용 중
포트 21: ✗ 사용 안함
포트 22: ✗ 사용 안함
포트 61: ✗ 사용 안함
총 5개 포트 중 1개가 사용 중입니다.

```

```
#!/bin/bash

#exec 2> /dev/null
#port2="$1"

used_port=0
for port in $@
do
    #  port=$(ss -tulnp | grep "python" | wc -l)        
   #  if [ ! $port -eq 1 ]; then

     if lsof -i :$port > /dev/null 2>&1; then
             echo "포트 $port: ✓ 사용 중"
             used_port=$((used_port+1))
     else
             echo "포트 $port: ✗ 사용 안함"
     fi

done
         echo "총 $#개 포트 중 $used_port개가 사용 중입니다."



```
---

## 연습문제 2: 특정 포트 프로세스 종료 스크립트

**문제**  
특정 포트를 사용하는 프로세스를 찾아서 종료하는 스크립트를 작성하세요.

**요구사항**
- `lsof -i :포트번호`로 PID 조회
- 프로세스 종료 (`kill -9 PID`)

**스크립트 실행 예제**
```bash
$ ./kill_port.sh 8080
포트 8080 사용 프로세스 검색 중...

  PID: 12345, 프로세스명: node
  PID: 12346, 프로세스명: nginx

프로세스 종료 중...
  PID 12345 종료 완료
  PID 12346 종료 완료

포트 8080이 해제되었습니다.

# 프로세스가 없는 경우
$ ./kill_port.sh 9999
포트 9999 사용 프로세스 검색 중...
포트 9999를 사용하는 프로세스가 없습니다.
```
# 답 :
```
[jeongho@localhost Downloads]$ source ./kill_port.sh 8080
포트 8080 사용 프로세스 검색 중...
PID: 3425, PSOSSCE:webcache (LISTEN) 
=====================================
프로세스 종료 중...
PID 3425 종료 완료
포트 8080 해제되었습니다.
[jeongho@localhost Downloads]$ source ./kill_port.sh 11
포트 11 사용 프로세스 검색 중...
포트 11  사용하는 프로세스가 없습니다.
```
```
#!/bin/bash
PORT="$1"
if lsof -i :$1 > /dev/null 2>&1; then
        echo "포트 $1 사용 프로세스 검색 중..."
     PROCESS_NAME=$(lsof -i :$1 | grep -v "NAME" | cut -d: -f2)
     ID=$(lsof -i :$1 | grep -v "NAME" | cut -d' ' -f2)
        echo "PID: $ID, PSOSSCE:$PROCESS_NAME "
        echo "====================================="
        echo "프로세스 종료 중..."
        echo "PID $ID 종료 완료"

        echo "포트 $1 해제되었습니다."
else
        echo "포트 $1 사용 프로세스 검색 중..."
        echo "포트 $1  사용하는 프로세스가 없습니다."
fi

```
---

## 연습문제 3: 웹 서비스 상태 모니터링 스크립트

**문제**  
설정 파일을 읽어 여러 웹 서비스의 상태를 확인하는 스크립트를 작성하세요.

**요구사항**
- 설정파일 형식: `IP:포트`
- `curl` 명령어 사용 (타임아웃 5초)

**스크립트 실행 예제**
```bash
$ ./monitor_services.sh
웹 서비스 상태 모니터링
========================

서비스 상태 확인 중...
192.168.1.100:80   ✓ 정상 (응답시간: 0.234초)
192.168.1.100:443  ✗ 연결 실패
localhost:3000     ✓ 정상 (응답시간: 0.012초)
192.168.1.200:8080 ✗ 타임아웃
localhost:22       ✗ HTTP 서비스 아님

========================
총 5개 서비스 중 2개 정상
모니터링 완료: 2024-07-28 14:30:15
```

---

## 연습문제 4: 네트워크 연결 테스트 스크립트

**문제**  
`telnet`을 이용하여 원격 서버의 포트 연결 상태를 확인하는 스크립트를 작성하세요.

**요구사항**
- 타임아웃 3초
- 입력 형식: `도메인:포트`

**스크립트 실행 예제**
```bash
$ ./test_connection.sh google.com:80 localhost:22 192.168.1.1:443
네트워크 연결 테스트 시작
==========================

google.com:80 연결 테스트 중...
  ✓ 연결 성공

localhost:22 연결 테스트 중...
  ✓ 연결 성공

192.168.1.1:443 연결 테스트 중...
  ✗ 연결 실패 (타임아웃)

==========================
테스트 완료: 3개 중 2개 성공
```

---

## 연습문제 5: 프로세스별 네트워크 포트 사용 현황 스크립트

**문제**  
현재 네트워크 포트를 사용하는 프로세스 정보를 출력하는 스크립트를 작성하세요.

**요구사항**
- `ss`로 `LISTEN` 상태 포트 확인
- `lsof`로 포트별 프로세스 확인
- 포트 번호별 정렬

**스크립트 실행 예제**
```bash
$ ./port_usage.sh
네트워크 포트 사용 현황
======================

LISTEN 상태 포트 분석 중...

포트 22 (SSH)
  프로세스: sshd (PID: 1234)
  주소: 0.0.0.0:22

포트 80 (HTTP)
  프로세스: nginx (PID: 5678)
  주소: 0.0.0.0:80

포트 3306 (MySQL)
  프로세스: mysqld (PID: 9012)
  주소: 127.0.0.1:3306

포트 8080 (사용자 정의)
  프로세스: java (PID: 3456)
  주소: 0.0.0.0:8080

======================
총 4개 포트가 LISTEN 상태입니다.
```

---

## 연습문제 6: 대량 포트 킬러 스크립트

**문제**  
포트 범위를 지정하여 해당 범위의 사용 중인 포트를 찾아 프로세스를 종료하는 스크립트를 작성하세요.

**요구사항**
- 범위 내 `lsof`로 사용 여부 확인
- 사용자 확인 후 `kill`

**스크립트 실행 예제**
```bash
$ ./kill_port_range.sh 3000 3010
포트 범위 3000-3010 검색 중...

사용 중인 포트 발견:
  포트 3000: node (PID: 12345)
  포트 3001: node (PID: 12346)
  포트 3005: python (PID: 12347)

위 3개 프로세스를 종료하시겠습니까? (y/N): y

프로세스 종료 중...
  포트 3000 (PID: 12345) 종료 완료
  포트 3001 (PID: 12346) 종료 완료
  포트 3005 (PID: 12347) 종료 완료

모든 프로세스가 종료되었습니다.
```

---

## 연습문제 7: 서비스 자동 재시작 스크립트

**문제**  
특정 포트의 서비스가 다운되었을 때 자동으로 재시작하는 스크립트를 작성하세요.

**요구사항**
- 포트/명령어 설정
- `curl` 또는 `telnet`으로 확인
- 기존 프로세스 종료 후 명령 실행

**스크립트 실행 예제**
```bash
$ ./auto_restart.sh
서비스 자동 재시작 모니터
========================

설정된 서비스들:
  - 포트 3000: npm start
  - 포트 8080: java -jar app.jar
  - 포트 5000: python app.py

모니터링 시작...

[14:30:15] 포트 3000 상태 확인... ✓ 정상
[14:30:16] 포트 8080 상태 확인... ✗ 다운됨
[14:30:16] 포트 8080 서비스 재시작 중...
[14:30:16] 기존 프로세스 정리 완료
[14:30:17] 새 프로세스 시작: java -jar app.jar
[14:30:20] 포트 8080 재시작 완료 ✓
[14:30:21] 포트 5000 상태 확인... ✓ 정상

다음 확인까지 30초 대기 중...
```

---

## 연습문제 8: 포트 스캐너 스크립트

**문제**  
특정 IP 주소의 포트 범위를 스캔하여 열린 포트를 찾는 스크립트를 작성하세요.

**요구사항**
- `telnet` 명령어 사용
- 타임아웃 2초
- 열린 포트만 출력

**스크립트 실행 예제**
```bash
$ ./port_scan.sh 192.168.1.100 20 30
192.168.1.100 포트 스캔 (범위: 20-30)
=====================================

스캔 진행 중... [###########] 100%

열린 포트 발견:
  포트 22: SSH (OpenSSH)
  포트 80: HTTP
  포트 443: HTTPS

=====================================
총 11개 포트 중 3개가 열려있습니다.
스캔 완료 시간: 22초
```

---

## 추가 도전 과제

### 도전
